# 20230802

## カレントディレクトリの調査

- random_cwd.bashを実行して、sleepがどのディレクトリで実行されたかを調べる

```bash
root@499194a15c28:/shell/qdata/113# cat random_cwd.bash
# #!/bin/bash

# cd "$(dirname $(find /etc 2>/dev/null | head -n 1000 | shuf | head -n 1))"
# sleep 1000 &
# echo "pid:$!"

```

- `$!`はbashの特殊な変数で、「直前にバックグラウンドで実行されたコマンドのプロセスID」に展開される
- あるコマンドがどこで実行されているかは、/proc以下を調べることでわかる
  - /proc以下にはプロセスIDに対応したディレクトリが作成される
  - これらの各ディレクトリの中には**cwd**というファイルがあり、それがカレントディレクトリへのシンボリックリンクになっている

```bash

root@499194a15c28:/shell/qdata/113# ls -l /proc/39/cwd
# lrwxrwxrwx 1 root root 0 Aug  2 05:18 /proc/39/cwd -> /etc/X11

```

- /etx/X11にてsleepが実行されたことがわかる
- ちなみに、プロセスのディレクトリには、cwdのほかにexeというファイルもあり、これは実行ファイル自体へのシンボリックリンクとなっている

### コマンド解説

```bash

find /etc 2>/dev/null | head -n 1000 | shuf | head -n 1

```

- findで/etc以下のファイルを列挙し、headで1,000個に打ち切っている
- その後、shufで1,000個のファイルパスをランダムに並び替え、最後にheadで一行選んでいるので、全体で/etc以下のパスをランダムに1つ選ぶという動作になる
