# CSVの列数の調査
- 一つだけ2列の値しか入っていない行が何行目なのかを求める
```bash
root@e70c1aa55c5a:/shell/qdata/59# cat data.csv
# 1,2,3
# "あ","い"",","う"
# "やや,""こし"",や〜","やや,""こし"",や〜",","
# "もう,"",","いや,"",や"
```
- 愚直に正規表現で求める
```bash
cat data.csv | grep -Eo '"([^"]*("")*)*"'
```
```bash
root@e70c1aa55c5a:/shell/qdata/59# cat data.csv | grep -Eo '"([^"]*("")*)*"'
# "あ"
# "い"","
# "う"
# "やや,""こし"",や〜"
# "やや,""こし"",や〜"
# ","
# "もう,"","
# "いや,"",や"
```
- 拡張表正規表現`'"([^"]*("")*)*"'`の意味
    - `[^"]*("")*`
        - "でない文字が0文字以上続いて、その後に""が0個以上続く
    - 上記の外側に`()*`をつけた`([^"]*("")*)*`  
        - ダブルクォーとを含まない文字列と、エスケープされたダブルクォートが、0個以上連結されたデータ

- "で囲まれていない値も切り出す
    - "も,も含まれないという意味で`[^,"]*`

```bash

cat data.csv | grep -Eo '[^,"]*|"([^"]*("")*)*"'

```
```bash
root@e70c1aa55c5a:/shell/qdata/59#  cat data.csv | grep -Eo '[^,"]*|"([^"]*("")*)*"'
# 1
# 2
# 3
# "あ"
# "い"","
# "う"
# "やや,""こし"",や〜"
# "やや,""こし"",や〜"
# ","
# "もう,"","
# "いや,"",や"
```
- 行番号をgrepの-nで出力する
```bash
root@e70c1aa55c5a:/shell/qdata/59# cat data.csv | grep -Eno '[^,"]*|"([^"]*("")*)*"'
# 1:1
# 1:2
# 1:3
# 2:"あ"
# 2:"い"","
# 2:"う"
# 3:"やや,""こし"",や〜"
# 3:"やや,""こし"",や〜"
# 3:","
# 4:"もう,"","
# 4:"いや,"",や"
```
- 出力のコロン以降を削除して行番号だけにし、行数をカウントする
```bash
root@e70c1aa55c5a:/shell/qdata/59# cat data.csv | grep -Eno '[^,"]*|"([^"]*("")*)*"' | sed 's/:.*//' | uniq -c
    #   3 1
    #   3 2
    #   3 3
    #   2 4
```

