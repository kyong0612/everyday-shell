# CPU負荷の調査
- `ps`を使うと、どのユーザがどのプロセスを立ち上げていて、どれだけシステムに負荷をかているかを調査できる
- `ps`のオプション
  - `ps aux` : ユーザごとにプロセスを表示

```bash
ps aux \
| awk 'NR>1{p[$1] += $3; n[$1]++}END{for(i in p)print p[i], n[i], i}'
```
- NR
    - レコード番号
- awkの最初のルールでは、2行目以降(ヘッダ以外の行)でpにCPU使用率、nに使っているプロセス数を集計している
- p,n ともにユーザをキーに持つ連想配列
  - ユーザごとの集計になる
- p,nでの集計結果は、ENDルールで出力される
- sortでレコードをdescで並び帰る
```bash
ps aux | awk '{ if(NR>1){p[$1] += $3; n[$1]++} }END{for(i in p) print p[i], n[i], i }' | sort -nrk 1,2
```




